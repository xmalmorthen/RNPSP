var mainFormActions={populateCURPFields:function(data){$("[name=pCURP]").val(data.CURP),$("[name=pCURP]").prop("readonly",!0),$("[name=pNOMBRE]").val(data.NOMBRE),$("[name=pNOMBRE]").prop("readonly",!0),$("[name=pPATERNO]").val(data.PATERNO),$("[name=pPATERNO]").prop("readonly",!0),$("[name=pMATERNO]").val(data.MATERNO),$("[name=pMATERNO]").prop("readonly",!0),$("[name=pID_JEFE]").val($.trim(data.NOMBRE_JEFE+data.PATERNO_JEFE+MATERNO_JEFE)),$("[name=pID_JEFE]").prop("readonly",!0)},populateData:function(idRef){$.LoadingOverlay("show",{image:"",fontawesome:"fa fa-cog fa-spin"});var callUrl=base_url+"Solicitud/ajaxGetSolicitudById";return new Promise(function(resolve,reject){$.get(callUrl,{idRef:idRef},function(data){resolve(data)}).fail(function(err){reject(err)})}).then(function(data){if(!data.results)throw new Error("No se encontró información");mainFormActions.fillData(data)}).catch(function(err){$.LoadingOverlay("hide"),Swal.fire({type:"error",title:"Error",html:err.statusText?err.statusText:err.message}).then(()=>{window.location.href=base_url+"Solicitud"})})},fillData:function(data){data=data.results.data,$.each(data,function(index,value){$("[name="+index+"]").val(value),$("[name="+index+"]").prop("readonly",!0)})},insertValueInSelect:function(ref,value){if(ref.length>0&&value)switch($objTypeOf=ref[0].tagName.toLowerCase(),$objTypeOf){case"input":switch($type=ref.attr("type").toLowerCase(),$type){case"text":case"password":case"date":case"email":case"hidden":case"number":ref.val(value)}break;case"select":0==ref.find("option:enabled").size()?ref.data("insert",value):(ref.val(value),ref.trigger("change.select2").trigger("change"))}}},_app=Backbone.View.extend({initialize:function(){this.generatePassword(),Swal.fire({title:"Clave CURP",input:"text",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"Aceptar",showLoaderOnConfirm:!0,preConfirm:CURP=>{try{if(CURP.length<18||CURP.length>20)throw new Error("Formato de CURP incorrecto");var sendData=[];return sendData.push({name:csrf.token_name,value:csrf.hash},{name:"pCURP",value:CURP}),new Promise(function(resolve,reject){callUrl=base_url+"Usuarios/buscarCurp",$.post(callUrl,sendData,function(data){resolve(data)}).fail(function(err){reject(err)})}).then(function(data){if(0==data.status)throw new Error("No se encontro la CURP en el sistema.");return{data:data.data}}).catch(function(err){Swal.showValidationMessage(err.statusText?err.statusText:err.message)})}catch(error){Swal.showValidationMessage(error)}},allowOutsideClick:!1,onBeforeOpen:()=>{$(".swal2-container").css("z-index","2000"),$(".swal2-container").data("preserve",!0).data("preserveCall","mainTabMenu.mainInit")}}).then(result=>{void 0!==result.dismiss?window.location.href=base_url+"Usuarios":mainFormActions.populateCURPFields(result.value)})},generarContrasena:function(length,type){switch(type){case"num":characters="0123456789";break;case"alf":characters="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";break;case"rand":break;default:characters="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"}var pass="";for(i=0;i<length;i++)pass+="rand"==type?String.fromCharCode(Math.floor(100*Math.random())%94+33):characters.charAt(Math.floor(Math.random()*characters.length));return pass},starLoader:function(){$.LoadingOverlay("show",{image:"",fontawesome:"fa fa-cog fa-spin"})},stopLoader:function(){$.LoadingOverlay("hide")},hideError:function(){$("[error=true]").length>0&&$("[error=true]").each(function(){$(this).removeError(),$(this).attr("error",!1)})},showError:function(message){var error="";$.each(message,function(index,value){$("input[name="+index+"]").length>0?($("input[name="+index+"]").attr("error",!0),$("input[name="+index+"]").setError(value)):error+="<small>"+value+"</small><br/>"}),error.length>0&&Swal.fire({type:"error",html:"<p>"+error+"</p>"})},generatePassword:function(){var pwd=this.generarContrasena(9);$("input#pCONTRASENA").val(pwd),$("input[name=pCONTRASENA]").val(pwd)},guardar:function(){var that=this;that.hideError();var sendData=$("form#Usuarios_form").serializeArray();sendData.push({name:csrf.token_name,value:csrf.hash}),Backbone.ajax({dataType:"json",method:"POST",url:base_url+"Usuarios/guardar",data:sendData,beforeSend:function(){that.starLoader()},success:function(response){1==response.status?($("form").trigger("reset"),that.generatePassword(),Swal.fire({type:"success",title:response.message}).then(result=>{location.reload()})):that.showError(response.message)},complete:function(){that.stopLoader()}})},regresar:function(){window.location.replace(base_url+"Usuarios")},render:function(){return this}}),app;$(function(){(app=new _app).render()});